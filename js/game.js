function transitionEndEventName(){var a,b,c=document.createElement("div"),d={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in d)if(d.hasOwnProperty(a)&&c.style[a]!==b)return d[a]}function getRandom(a,b){return Math.random()*(b-a)+a}function setDebug(a){DEBUG_MODE=a,localStorage.setItem("DEBUG_MODE",a),localStorage.setItem("showTutorial","false"),window.location.reload()}!function(){function b(){this.shotsTaken=0,this.shotsHit=0,this.totalShots=parseInt(localStorage.getItem("totalShots"),10)||0,this.totalHits=parseInt(localStorage.getItem("totalHits"),10)||0,this.gamesPlayed=parseInt(localStorage.getItem("gamesPlayed"),10)||0,this.gamesWon=parseInt(localStorage.getItem("gamesWon"),10)||0,this.uuid=localStorage.getItem("uuid")||this.createUUID(),DEBUG_MODE&&(this.skipCurrentGame=!0)}function c(a){c.size=a,this.shotsTaken=0,this.createGrid(),this.init()}function d(a){this.size=a,this.cells=[],this.init()}function e(b,c){this.numShips=a.AVAILABLE_SHIPS.length,this.playerGrid=b,this.player=c,this.fleetRoster=[],this.populate()}function f(b,c,d){switch(this.damage=0,this.type=b,this.playerGrid=c,this.player=d,this.type){case a.AVAILABLE_SHIPS[0]:this.shipLength=5;break;case a.AVAILABLE_SHIPS[1]:this.shipLength=4;break;case a.AVAILABLE_SHIPS[2]:this.shipLength=3;break;case a.AVAILABLE_SHIPS[3]:this.shipLength=3;break;case a.AVAILABLE_SHIPS[4]:this.shipLength=2;break;default:this.shipLength=3}this.maxDamage=this.shipLength,this.sunk=!1}function g(){this.currentStep=0,this.showTutorial="false"!==localStorage.getItem("showTutorial")}function h(b){this.gameObject=b,this.virtualGrid=new d(c.size),this.virtualFleet=new e(this.virtualGrid,a.VIRTUAL_PLAYER),this.probGrid=[],this.initProbs(),this.updateProbs()}var a={};a.AVAILABLE_SHIPS=["carrier","battleship","destroyer","submarine","patrolboat"],a.HUMAN_PLAYER=0,a.COMPUTER_PLAYER=1,a.VIRTUAL_PLAYER=2,a.CSS_TYPE_EMPTY="empty",a.CSS_TYPE_SHIP="ship",a.CSS_TYPE_MISS="miss",a.CSS_TYPE_HIT="hit",a.CSS_TYPE_SUNK="sunk",a.TYPE_EMPTY=0,a.TYPE_SHIP=1,a.TYPE_MISS=2,a.TYPE_HIT=3,a.TYPE_SUNK=4,c.usedShips=[a.UNUSED,a.UNUSED,a.UNUSED,a.UNUSED,a.UNUSED],a.USED=1,a.UNUSED=0,b.prototype.incrementShots=function(){this.shotsTaken++},b.prototype.hitShot=function(){this.shotsHit++},b.prototype.wonGame=function(){this.gamesPlayed++,this.gamesWon++,DEBUG_MODE||ga("send","event","gameOver","win",this.uuid)},b.prototype.lostGame=function(){this.gamesPlayed++,DEBUG_MODE||ga("send","event","gameOver","lose",this.uuid)},b.prototype.syncStats=function(){if(this.skipCurrentGame)this.skipCurrentGame=!1;else{var a=parseInt(localStorage.getItem("totalShots"),10)||0;a+=this.shotsTaken;var b=parseInt(localStorage.getItem("totalHits"),10)||0;b+=this.shotsHit,localStorage.setItem("totalShots",a),localStorage.setItem("totalHits",b),localStorage.setItem("gamesPlayed",this.gamesPlayed),localStorage.setItem("gamesWon",this.gamesWon),localStorage.setItem("uuid",this.uuid)}for(var d="",e=0;e<c.size;e++)for(var f=0;f<c.size;f++)d+="("+e+","+f+"):"+j.humanGrid.cells[e][f]+";\n";DEBUG_MODE||ga("send","event","humanGrid",d,this.uuid)},b.prototype.updateStatsSidebar=function(){var a=document.getElementById("stats-wins"),b=document.getElementById("stats-accuracy");a.innerHTML=this.gamesWon+" of "+this.gamesPlayed,b.innerHTML=Math.round(100*this.totalHits/this.totalShots||0)+"%"},b.prototype.resetStats=function(a){c.stats.skipCurrentGame=!0,localStorage.setItem("totalShots",0),localStorage.setItem("totalHits",0),localStorage.setItem("gamesPlayed",0),localStorage.setItem("gamesWon",0),localStorage.setItem("showTutorial",!0),c.stats.shotsTaken=0,c.stats.shotsHit=0,c.stats.totalShots=0,c.stats.totalHits=0,c.stats.gamesPlayed=0,c.stats.gamesWon=0,c.stats.updateStatsSidebar()},b.prototype.createUUID=function(a,b){var e,c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),d=[];if(b=b||c.length,a)for(e=0;e<a;e++)d[e]=c[0|Math.random()*b];else{var f;for(d[8]=d[13]=d[18]=d[23]="-",d[14]="4",e=0;e<36;e++)d[e]||(f=0|16*Math.random(),d[e]=c[19===e?3&f|8:f])}return d.join("")},c.size=10,c.gameOver=!1,c.prototype.checkIfWon=function(){this.computerFleet.allShipsSunk()?(alert("Bạn đã Thắng! \n* Nhấn F5 để tải lại *"),c.gameOver=!0,c.stats.wonGame(),c.stats.syncStats(),c.stats.updateStatsSidebar(),this.showRestartSidebar()):this.humanFleet.allShipsSunk()&&(alert("Bạn Thua rồi! \n* Nhấn F5 để tải lại *."),c.gameOver=!0,c.stats.lostGame(),c.stats.syncStats(),c.stats.updateStatsSidebar(),this.showRestartSidebar())},c.prototype.shoot=function(b,c,d){var e,f;return d===a.HUMAN_PLAYER?(e=this.humanGrid,f=this.humanFleet):d===a.COMPUTER_PLAYER?(e=this.computerGrid,f=this.computerFleet):console.log("There was an error trying to find the correct player to target"),e.isDamagedShip(b,c)?null:e.isMiss(b,c)?null:e.isUndamagedShip(b,c)?(e.updateCell(b,c,"hit",d),f.findShipByCoords(b,c).incrementDamage(),this.checkIfWon(),a.TYPE_HIT):(e.updateCell(b,c,"miss",d),this.checkIfWon(),a.TYPE_MISS)},c.prototype.shootListener=function(b){var d=b.target.self,e=parseInt(b.target.getAttribute("data-x"),10),f=parseInt(b.target.getAttribute("data-y"),10),g=null;d.readyToPlay&&(g=d.shoot(e,f,a.COMPUTER_PLAYER),i.showTutorial&&i.nextStep()),null===g||c.gameOver?c.gameOver=!1:(c.stats.incrementShots(),g===a.TYPE_HIT&&c.stats.hitShot(),d.robot.shoot())},c.prototype.rosterListener=function(a){for(var b=a.target.self,d=document.querySelectorAll(".fleet-roster li"),e=0;e<d.length;e++){var f=d[e].getAttribute("class")||"";f=f.replace("placing",""),d[e].setAttribute("class",f)}1===i.currentStep&&i.nextStep(),c.placeShipType=a.target.getAttribute("id"),document.getElementById(c.placeShipType).setAttribute("class","placing"),c.placeShipDirection=parseInt(document.getElementById("rotate-button").getAttribute("data-direction"),10),b.placingOnGrid=!0},c.prototype.placementListener=function(a){var b=a.target.self;if(b.placingOnGrid){var d=parseInt(a.target.getAttribute("data-x"),10),e=parseInt(a.target.getAttribute("data-y"),10),f=b.humanFleet.placeShip(d,e,c.placeShipDirection,c.placeShipType);if(f&&(b.endPlacing(c.placeShipType),2===i.currentStep&&i.nextStep(),b.placingOnGrid=!1,b.areAllShipsPlaced())){var g=document.getElementById("rotate-button");g.addEventListener(transitionEndEventName(),function(){g.setAttribute("class","hidden"),i.showTutorial?document.getElementById("start-game").setAttribute("class","highlight"):document.getElementById("start-game").removeAttribute("class")},!1),g.setAttribute("class","invisible")}}},c.prototype.placementMouseover=function(a){var b=a.target.self;if(b.placingOnGrid)for(var f,d=parseInt(a.target.getAttribute("data-x"),10),e=parseInt(a.target.getAttribute("data-y"),10),g=b.humanFleet.fleetRoster,h=0;h<g.length;h++){var i=g[h].type;if(c.placeShipType===i&&g[h].isLegal(d,e,c.placeShipDirection)){g[h].create(d,e,c.placeShipDirection,!0),c.placeShipCoords=g[h].getAllShipCells();for(var j=0;j<c.placeShipCoords.length;j++){var k=document.querySelector(".grid-cell-"+c.placeShipCoords[j].x+"-"+c.placeShipCoords[j].y);f=k.getAttribute("class"),f.indexOf(" grid-ship")<0&&(f+=" grid-ship",k.setAttribute("class",f))}}}},c.prototype.placementMouseout=function(a){var b=a.target.self;if(b.placingOnGrid)for(var d=0;d<c.placeShipCoords.length;d++){var e=document.querySelector(".grid-cell-"+c.placeShipCoords[d].x+"-"+c.placeShipCoords[d].y);classes=e.getAttribute("class"),classes.indexOf(" grid-ship")>-1&&(classes=classes.replace(" grid-ship",""),e.setAttribute("class",classes))}},c.prototype.toggleRotation=function(a){var b=parseInt(a.target.getAttribute("data-direction"),10);b===f.DIRECTION_VERTICAL?(a.target.setAttribute("data-direction","1"),c.placeShipDirection=f.DIRECTION_HORIZONTAL):b===f.DIRECTION_HORIZONTAL&&(a.target.setAttribute("data-direction","0"),c.placeShipDirection=f.DIRECTION_VERTICAL)},c.prototype.startGame=function(a){var b=a.target.self,c=document.getElementById("roster-sidebar"),d=function(){c.setAttribute("class","hidden")};c.addEventListener(transitionEndEventName(),d,!1),c.setAttribute("class","invisible"),b.readyToPlay=!0,3===i.currentStep&&i.nextStep(),c.removeEventListener(transitionEndEventName(),d,!1)},c.prototype.restartGame=function(a){a.target.removeEventListener(a.type,arguments.callee);var b=a.target.self;document.getElementById("restart-sidebar").setAttribute("class","hidden"),b.resetFogOfWar(),b.init()},c.prototype.placeRandomly=function(a){a.target.removeEventListener(a.type,arguments.callee),a.target.self.humanFleet.placeShipsRandomly(),a.target.self.readyToPlay=!0,document.getElementById("roster-sidebar").setAttribute("class","hidden"),this.setAttribute("class","hidden")},c.prototype.endPlacing=function(b){document.getElementById(b).setAttribute("class","placed"),c.usedShips[a.AVAILABLE_SHIPS.indexOf(b)]=a.USED,c.placeShipDirection=null,c.placeShipType="",c.placeShipCoords=[]},c.prototype.areAllShipsPlaced=function(){for(var a=document.querySelectorAll(".fleet-roster li"),b=0;b<a.length;b++)if("placed"!==a[b].getAttribute("class"))return!1;return c.placeShipDirection=0,c.placeShipType="",c.placeShipCoords=[],!0},c.prototype.resetFogOfWar=function(){for(var b=0;b<c.size;b++)for(var d=0;d<c.size;d++)this.humanGrid.updateCell(b,d,"empty",a.HUMAN_PLAYER),this.computerGrid.updateCell(b,d,"empty",a.COMPUTER_PLAYER);c.usedShips=c.usedShips.map(function(){return a.UNUSED})},c.prototype.resetRosterSidebar=function(){for(var a=document.querySelector(".fleet-roster").querySelectorAll("li"),b=0;b<a.length;b++)a[b].removeAttribute("class");i.showTutorial?i.nextStep():document.getElementById("roster-sidebar").removeAttribute("class"),document.getElementById("rotate-button").removeAttribute("class"),document.getElementById("start-game").setAttribute("class","hidden"),DEBUG_MODE&&document.getElementById("place-randomly").removeAttribute("class")},c.prototype.showRestartSidebar=function(){var a=document.getElementById("restart-sidebar");a.setAttribute("class","highlight");for(var b=document.querySelector(".computer-player").childNodes,c=0;c<b.length;c++)b[c].removeEventListener("click",this.shootListener,!1);for(var d=document.querySelector(".fleet-roster").querySelectorAll("li"),e=0;e<d.length;e++)d[e].removeEventListener("click",this.rosterListener,!1);var f=document.getElementById("restart-game");f.addEventListener("click",this.restartGame,!1),f.self=this},c.prototype.createGrid=function(){for(var a=document.querySelectorAll(".grid"),b=0;b<a.length;b++){a[b].removeChild(a[b].querySelector(".no-js"));for(var d=0;d<c.size;d++)for(var e=0;e<c.size;e++){var f=document.createElement("div");f.setAttribute("data-x",d),f.setAttribute("data-y",e),f.setAttribute("class","grid-cell grid-cell-"+d+"-"+e),a[b].appendChild(f)}}},c.prototype.init=function(){this.humanGrid=new d(c.size),this.computerGrid=new d(c.size),this.humanFleet=new e(this.humanGrid,a.HUMAN_PLAYER),this.computerFleet=new e(this.computerGrid,a.COMPUTER_PLAYER),this.robot=new h(this),c.stats=new b,c.stats.updateStatsSidebar(),this.shotsTaken=0,this.readyToPlay=!1,this.placingOnGrid=!1,c.placeShipDirection=0,c.placeShipType="",c.placeShipCoords=[],this.resetRosterSidebar();for(var f=document.querySelector(".computer-player").childNodes,g=0;g<f.length;g++)f[g].self=this,f[g].addEventListener("click",this.shootListener,!1);for(var i=document.querySelector(".fleet-roster").querySelectorAll("li"),j=0;j<i.length;j++)i[j].self=this,i[j].addEventListener("click",this.rosterListener,!1);for(var k=document.querySelector(".human-player").childNodes,l=0;l<k.length;l++)k[l].self=this,k[l].addEventListener("click",this.placementListener,!1),k[l].addEventListener("mouseover",this.placementMouseover,!1),k[l].addEventListener("mouseout",this.placementMouseout,!1);var m=document.getElementById("rotate-button");m.addEventListener("click",this.toggleRotation,!1);var n=document.getElementById("start-game");n.self=this,n.addEventListener("click",this.startGame,!1);var o=document.getElementById("reset-stats");o.addEventListener("click",c.stats.resetStats,!1);var p=document.getElementById("place-randomly");p.self=this,p.addEventListener("click",this.placeRandomly,!1),this.computerFleet.placeShipsRandomly()},d.prototype.init=function(){for(var b=0;b<this.size;b++){var c=[];this.cells[b]=c;for(var d=0;d<this.size;d++)c.push(a.TYPE_EMPTY)}},d.prototype.updateCell=function(b,c,d,e){var f;switch(e===a.HUMAN_PLAYER?f="human-player":e===a.COMPUTER_PLAYER?f="computer-player":console.log("There was an error trying to find the correct player's grid"),d){case a.CSS_TYPE_EMPTY:this.cells[b][c]=a.TYPE_EMPTY;break;case a.CSS_TYPE_SHIP:this.cells[b][c]=a.TYPE_SHIP;break;case a.CSS_TYPE_MISS:this.cells[b][c]=a.TYPE_MISS;break;case a.CSS_TYPE_HIT:this.cells[b][c]=a.TYPE_HIT;break;case a.CSS_TYPE_SUNK:this.cells[b][c]=a.TYPE_SUNK;break;default:this.cells[b][c]=a.TYPE_EMPTY}var g=["grid-cell","grid-cell-"+b+"-"+c,"grid-"+d];document.querySelector("."+f+" .grid-cell-"+b+"-"+c).setAttribute("class",g.join(" "))},d.prototype.isUndamagedShip=function(b,c){return this.cells[b][c]===a.TYPE_SHIP},d.prototype.isMiss=function(b,c){return this.cells[b][c]===a.TYPE_MISS},d.prototype.isDamagedShip=function(b,c){return this.cells[b][c]===a.TYPE_HIT||this.cells[b][c]===a.TYPE_SUNK},e.prototype.populate=function(){for(var b=0;b<this.numShips;b++){var c=b%a.AVAILABLE_SHIPS.length;this.fleetRoster.push(new f(a.AVAILABLE_SHIPS[c],this.playerGrid,this.player))}},e.prototype.placeShip=function(a,b,c,d){for(var e,f=0;f<this.fleetRoster.length;f++){var g=this.fleetRoster[f].type;if(d===g&&this.fleetRoster[f].isLegal(a,b,c)){this.fleetRoster[f].create(a,b,c,!1),e=this.fleetRoster[f].getAllShipCells();for(var h=0;h<e.length;h++)this.playerGrid.updateCell(e[h].x,e[h].y,"ship",this.player);return!0}}return!1},e.prototype.placeShipsRandomly=function(){for(var b,d=0;d<this.fleetRoster.length;d++){var e=!0;if(this.player!==a.HUMAN_PLAYER||c.usedShips[d]!==a.USED){for(;e;){var f=Math.floor(10*Math.random()),g=Math.floor(10*Math.random()),h=Math.floor(2*Math.random());this.fleetRoster[d].isLegal(f,g,h)&&(this.fleetRoster[d].create(f,g,h,!1),b=this.fleetRoster[d].getAllShipCells(),e=!1)}if(this.player===a.HUMAN_PLAYER&&c.usedShips[d]!==a.USED)for(var i=0;i<b.length;i++)this.playerGrid.updateCell(b[i].x,b[i].y,"ship",this.player),c.usedShips[d]=a.USED}}},e.prototype.findShipByCoords=function(a,b){for(var c=0;c<this.fleetRoster.length;c++){var d=this.fleetRoster[c];if(d.direction!==f.DIRECTION_VERTICAL){if(a===d.xPosition&&b>=d.yPosition&&b<d.yPosition+d.shipLength)return d}else if(b===d.yPosition&&a>=d.xPosition&&a<d.xPosition+d.shipLength)return d}return null},e.prototype.findShipByType=function(a){for(var b=0;b<this.fleetRoster.length;b++)if(this.fleetRoster[b].type===a)return this.fleetRoster[b];return null},e.prototype.allShipsSunk=function(){for(var a=0;a<this.fleetRoster.length;a++)if(this.fleetRoster[a].sunk===!1)return!1;return!0},f.prototype.isLegal=function(b,c,d){if(this.withinBounds(b,c,d)){for(var e=0;e<this.shipLength;e++)if(d===f.DIRECTION_VERTICAL){if(this.playerGrid.cells[b+e][c]===a.TYPE_SHIP||this.playerGrid.cells[b+e][c]===a.TYPE_MISS||this.playerGrid.cells[b+e][c]===a.TYPE_SUNK)return!1}else if(this.playerGrid.cells[b][c+e]===a.TYPE_SHIP||this.playerGrid.cells[b][c+e]===a.TYPE_MISS||this.playerGrid.cells[b][c+e]===a.TYPE_SUNK)return!1;return!0}return!1},f.prototype.withinBounds=function(a,b,d){return d===f.DIRECTION_VERTICAL?a+this.shipLength<=c.size:b+this.shipLength<=c.size},f.prototype.incrementDamage=function(){this.damage++,this.isSunk()&&this.sinkShip(!1)},f.prototype.isSunk=function(){return this.damage>=this.maxDamage},f.prototype.sinkShip=function(a){if(this.damage=this.maxDamage,this.sunk=!0,!a)for(var b=this.getAllShipCells(),c=0;c<this.shipLength;c++)this.playerGrid.updateCell(b[c].x,b[c].y,"sunk",this.player)},f.prototype.getAllShipCells=function(){for(var a=[],b=0;b<this.shipLength;b++)this.direction===f.DIRECTION_VERTICAL?a[b]={x:this.xPosition+b,y:this.yPosition}:a[b]={x:this.xPosition,y:this.yPosition+b};return a},f.prototype.create=function(b,c,d,e){if(this.xPosition=b,this.yPosition=c,this.direction=d,!e)for(var g=0;g<this.shipLength;g++)this.direction===f.DIRECTION_VERTICAL?this.playerGrid.cells[b+g][c]=a.TYPE_SHIP:this.playerGrid.cells[b][c+g]=a.TYPE_SHIP},f.DIRECTION_VERTICAL=0,f.DIRECTION_HORIZONTAL=1,g.prototype.nextStep=function(){var a=document.querySelector(".human-player"),b=document.querySelector(".computer-player");switch(this.currentStep){case 0:document.getElementById("roster-sidebar").setAttribute("class","highlight"),document.getElementById("step1").setAttribute("class","current-step"),this.currentStep++;break;case 1:document.getElementById("roster-sidebar").removeAttribute("class"),document.getElementById("step1").removeAttribute("class"),a.setAttribute("class",a.getAttribute("class")+" highlight"),document.getElementById("step2").setAttribute("class","current-step"),this.currentStep++;break;case 2:document.getElementById("step2").removeAttribute("class");var c=a.getAttribute("class");c=c.replace(" highlight",""),a.setAttribute("class",c),this.currentStep++;break;case 3:b.setAttribute("class",b.getAttribute("class")+" highlight"),document.getElementById("step3").setAttribute("class","current-step"),this.currentStep++;break;case 4:var d=b.getAttribute("class");document.getElementById("step3").removeAttribute("class"),d=d.replace(" highlight",""),b.setAttribute("class",d),document.getElementById("step4").setAttribute("class","current-step"),this.currentStep++;break;case 5:document.getElementById("step4").removeAttribute("class"),this.currentStep=6,this.showTutorial=!1,localStorage.setItem("showTutorial",!1)}},h.PROB_WEIGHT=5e3,h.OPEN_HIGH_MIN=20,h.OPEN_HIGH_MAX=30,h.OPEN_MED_MIN=15,h.OPEN_MED_MAX=25,h.OPEN_LOW_MIN=10,h.OPEN_LOW_MAX=20,h.RANDOMNESS=.1,h.OPENINGS=[{x:7,y:3,weight:getRandom(h.OPEN_LOW_MIN,h.OPEN_LOW_MAX)},{x:6,y:2,weight:getRandom(h.OPEN_LOW_MIN,h.OPEN_LOW_MAX)},{x:3,y:7,weight:getRandom(h.OPEN_LOW_MIN,h.OPEN_LOW_MAX)},{x:2,y:6,weight:getRandom(h.OPEN_LOW_MIN,h.OPEN_LOW_MAX)},{x:6,y:6,weight:getRandom(h.OPEN_LOW_MIN,h.OPEN_LOW_MAX)},{x:3,y:3,weight:getRandom(h.OPEN_LOW_MIN,h.OPEN_LOW_MAX)},{x:5,y:5,weight:getRandom(h.OPEN_LOW_MIN,h.OPEN_LOW_MAX)},{x:4,y:4,weight:getRandom(h.OPEN_LOW_MIN,h.OPEN_LOW_MAX)},{x:0,y:8,weight:getRandom(h.OPEN_MED_MIN,h.OPEN_MED_MAX)},{x:1,y:9,weight:getRandom(h.OPEN_HIGH_MIN,h.OPEN_HIGH_MAX)},{x:8,y:0,weight:getRandom(h.OPEN_MED_MIN,h.OPEN_MED_MAX)},{x:9,y:1,weight:getRandom(h.OPEN_HIGH_MIN,h.OPEN_HIGH_MAX)},{x:9,y:9,weight:getRandom(h.OPEN_HIGH_MIN,h.OPEN_HIGH_MAX)},{x:0,y:0,weight:getRandom(h.OPEN_HIGH_MIN,h.OPEN_HIGH_MAX)}],h.prototype.shoot=function(){for(var d,b=0,e=[],f=0;f<h.OPENINGS.length;f++){var g=h.OPENINGS[f];0!==this.probGrid[g.x][g.y]&&(this.probGrid[g.x][g.y]+=g.weight)}for(var i=0;i<c.size;i++)for(var j=0;j<c.size;j++)this.probGrid[i][j]>b?(b=this.probGrid[i][j],e=[{x:i,y:j}]):this.probGrid[i][j]===b&&e.push({x:i,y:j});d=Math.random()<h.RANDOMNESS?e[Math.floor(Math.random()*e.length)]:e[0];var k=this.gameObject.shoot(d.x,d.y,a.HUMAN_PLAYER);if(c.gameOver)return void(c.gameOver=!1);if(this.virtualGrid.cells[d.x][d.y]=k,k===a.TYPE_HIT){var l=this.findHumanShip(d.x,d.y);if(l.isSunk()){for(var m=[],n=0;n<this.virtualFleet.fleetRoster.length;n++)m.push(this.virtualFleet.fleetRoster[n].type);var o=m.indexOf(l.type);this.virtualFleet.fleetRoster.splice(o,1);for(var p=l.getAllShipCells(),q=0;q<p.length;q++)this.virtualGrid.cells[p[q].x][p[q].y]=a.TYPE_SUNK}}this.updateProbs()},h.prototype.updateProbs=function(){var d,b=this.virtualFleet.fleetRoster;this.resetProbs();for(var e=0;e<b.length;e++)for(var g=0;g<c.size;g++)for(var i=0;i<c.size;i++){if(b[e].isLegal(g,i,f.DIRECTION_VERTICAL))if(b[e].create(g,i,f.DIRECTION_VERTICAL,!0),d=b[e].getAllShipCells(),this.passesThroughHitCell(d))for(var j=0;j<d.length;j++)this.probGrid[d[j].x][d[j].y]+=h.PROB_WEIGHT*this.numHitCellsCovered(d);else for(var k=0;k<d.length;k++)this.probGrid[d[k].x][d[k].y]++;if(b[e].isLegal(g,i,f.DIRECTION_HORIZONTAL))if(b[e].create(g,i,f.DIRECTION_HORIZONTAL,!0),d=b[e].getAllShipCells(),this.passesThroughHitCell(d))for(var l=0;l<d.length;l++)this.probGrid[d[l].x][d[l].y]+=h.PROB_WEIGHT*this.numHitCellsCovered(d);else for(var m=0;m<d.length;m++)this.probGrid[d[m].x][d[m].y]++;this.virtualGrid.cells[g][i]===a.TYPE_HIT&&(this.probGrid[g][i]=0)}},h.prototype.initProbs=function(){for(var a=0;a<c.size;a++){var b=[];this.probGrid[a]=b;for(var d=0;d<c.size;d++)b.push(0)}},h.prototype.resetProbs=function(){for(var a=0;a<c.size;a++)for(var b=0;b<c.size;b++)this.probGrid[a][b]=0},h.prototype.metagame=function(){},h.prototype.findHumanShip=function(a,b){return this.gameObject.humanFleet.findShipByCoords(a,b)},h.prototype.passesThroughHitCell=function(b){for(var c=0;c<b.length;c++)if(this.virtualGrid.cells[b[c].x][b[c].y]===a.TYPE_HIT)return!0;return!1},h.prototype.numHitCellsCovered=function(b){for(var c=0,d=0;d<b.length;d++)this.virtualGrid.cells[b[d].x][b[d].y]===a.TYPE_HIT&&c++;return c};var i=new g,j=new c(10)}(),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(null===this||void 0===this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;var f=+b||0;if(Math.abs(f)===1/0&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);c<e;){if(c in d&&d[c]===a)return c;c++}return-1}),Array.prototype.map||(Array.prototype.map=function(a,b){var c,d,e;if(null==this)throw new TypeError(" this is null or not defined");var f=Object(this),g=f.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=new Array(g),e=0;e<g;){var h,i;e in f&&(h=f[e],i=a.call(c,h,e,f),d[e]=i),e++}return d});